<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>APIM Test Console</title>
    <style>
      :root {
        font-family: "Segoe UI", Arial, sans-serif;
        color: #f8fbff;
        background-color: #0b0f19;
      }

      body {
        margin: 0;
        padding: 0;
        background: radial-gradient(circle at top, #1b2236, #090d17);
        color: #e8edf9;
      }

      a {
        color: #8cc7ff;
      }

      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 2rem 1.5rem 3rem;
      }

      .panel {
        background: #12192b;
        border-radius: 14px;
        padding: 1.5rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
        margin-bottom: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .hero h1 {
        margin-top: 0;
        font-size: 2rem;
      }

      .hero p {
        color: #a6b4d7;
      }

      h2 {
        margin-top: 0;
        letter-spacing: 0.02em;
      }

      .playbook-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
      }

      .playbook-card {
        background: #0f1523;
        border-radius: 12px;
        padding: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.07);
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .playbook-card header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .tag {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        background: #1f2b44;
        padding: 0.2rem 0.8rem;
        border-radius: 999px;
        color: #9eb6ff;
      }

      code {
        display: block;
        background: #111a2c;
        padding: 0.75rem;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        color: #f4f7ff;
        font-size: 0.9rem;
      }

      .playbook-links {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      button {
        font: inherit;
        border: none;
        border-radius: 6px;
        padding: 0.4rem 0.9rem;
        cursor: pointer;
        color: #fff;
        background: linear-gradient(120deg, #2972ff, #5ad1ff);
      }

      button:hover {
        filter: brightness(1.05);
      }

      .secondary {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: #d7e3ff;
      }

      label {
        font-weight: 600;
        display: block;
        margin-bottom: 0.3rem;
      }

      input,
      textarea {
        width: 100%;
        padding: 0.6rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.04);
        color: #f8fbff;
        box-sizing: border-box;
      }

      textarea {
        resize: vertical;
        min-height: 90px;
      }

      .inline-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
        gap: 1rem;
      }

      .command-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1rem;
      }

      .command-card {
        border-radius: 10px;
        padding: 1rem;
        background: #161f33;
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .badge {
        display: inline-block;
        padding: 0.2rem 0.6rem;
        border-radius: 999px;
        font-size: 0.75rem;
        color: #fff;
      }

      .badge.get {
        background: #13a77b;
      }

      .badge.post {
        background: #d76d5b;
      }

      pre {
        background: #050913;
        color: #dbe6ff;
        padding: 1rem;
        border-radius: 10px;
        min-height: 160px;
        overflow-x: auto;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .note {
        color: #98a6cc;
      }
    </style>
  </head>
  <body>
    <main>
      <section class="panel hero">
        <h1>APIM Test Console</h1>
        <p>
          This dark-mode dashboard is the single source of truth for smoke tests, automation scripts,
          and API poking tools. Use the cards below as your "man page" for stakeholders and keep every
          command discoverable in one place.
        </p>
      </section>

      <section class="panel">
        <h2>Test Playbook</h2>
        <p class="note">
          Click "Copy command" to grab a ready-to-run snippet. The "Open file" links download the script
          and "Open folder" links browse the repo via this local server.
        </p>
        <div class="playbook-grid">
          <article class="playbook-card">
            <header>
              <h3>Start server (background)</h3>
              <span class="tag">Automation</span>
            </header>
            <p>Launches <code>apim-cpp-server.exe</code>, captures logs under <code>.apim/logs</code>, and waits for <code>/api/health</code>.</p>
            <code>pwsh .\tools\automation\start_apim_server.ps1</code>
            <div class="playbook-links">
              <button class="copy-button" data-copy="pwsh .\tools\automation\start_apim_server.ps1">Copy command</button>
              <a class="secondary" href="../../tools/automation/start_apim_server.ps1" target="_blank">Open file</a>
              <a class="secondary" href="../../tools/automation/" target="_blank">Open folder</a>
            </div>
          </article>

          <article class="playbook-card">
            <header>
              <h3>Stop server</h3>
              <span class="tag">Automation</span>
            </header>
            <p>Reads <code>.apim/server.pid</code> and terminates the tracked process so you can rebuild safely.</p>
            <code>pwsh .\tools\automation\stop_apim_server.ps1</code>
            <div class="playbook-links">
              <button class="copy-button" data-copy="pwsh .\tools\automation\stop_apim_server.ps1">Copy command</button>
              <a class="secondary" href="../../tools/automation/stop_apim_server.ps1" target="_blank">Open file</a>
              <a class="secondary" href="../../tools/automation/" target="_blank">Open folder</a>
            </div>
          </article>

          <article class="playbook-card">
            <header>
              <h3>CLI smoke test (PowerShell)</h3>
              <span class="tag">Client</span>
            </header>
            <p>Exercises every API endpoint sequentially and prints prettified JSON responses.</p>
            <code>pwsh .\APIM-CPP-CLIENT\Invoke-DemoRequests.ps1</code>
            <div class="playbook-links">
              <button class="copy-button" data-copy="pwsh .\APIM-CPP-CLIENT\Invoke-DemoRequests.ps1">Copy command</button>
              <a class="secondary" href="../Invoke-DemoRequests.ps1" target="_blank">Open file</a>
              <a class="secondary" href=".." target="_blank">Open folder</a>
            </div>
          </article>

          <article class="playbook-card">
            <header>
              <h3>Host this dashboard</h3>
              <span class="tag">Utility</span>
            </header>
            <p>Runs a lightweight HTTP server (loopback only) so browsers can fetch the API without CORS drama.</p>
            <code>pwsh .\APIM-CPP-CLIENT\web\Start-WebDemo.ps1</code>
            <div class="playbook-links">
              <button class="copy-button" data-copy="pwsh .\APIM-CPP-CLIENT\web\Start-WebDemo.ps1">Copy command</button>
              <a class="secondary" href="Start-WebDemo.ps1" target="_blank">Open file</a>
              <a class="secondary" href="." target="_blank">Open folder</a>
            </div>
          </article>

          <article class="playbook-card">
            <header>
              <h3>MCP bridge</h3>
              <span class="tag">Agents</span>
            </header>
            <p>Expose the demo API as Model Context Protocol tools for Cursor, Claude Desktop, or any MCP host.</p>
            <code>.\build\apim-mcp-bridge.exe</code>
            <div class="playbook-links">
              <button class="copy-button" data-copy=".\build\apim-mcp-bridge.exe">Copy command</button>
              <a class="secondary" href="../../build/apim-mcp-bridge.exe" target="_blank">Open file</a>
              <a class="secondary" href="../../build/" target="_blank">Open folder</a>
            </div>
          </article>

          <article class="playbook-card">
            <header>
              <h3>Build + test sweep</h3>
              <span class="tag">CI step</span>
            </header>
            <p>Configure + build with Ninja and run the MCP ctest target to ensure the bridge stays healthy.</p>
            <code>cmake --build build &amp;&amp; ctest --output-on-failure</code>
            <div class="playbook-links">
              <button class="copy-button" data-copy="cmake --build build && ctest --output-on-failure">Copy command</button>
              <a class="secondary" href="../../build/" target="_blank">Open build folder</a>
              <a class="secondary" href="../../" target="_blank">Repo root</a>
            </div>
          </article>
        </div>
      </section>

      <section class="panel">
        <h2>Live endpoint</h2>
        <p class="note">Point these controls at localhost or any forwarded host/port combo before clicking the API buttons.</p>
        <div class="inline-inputs">
          <div>
            <label for="hostInput">Host</label>
            <input id="hostInput" value="127.0.0.1" />
          </div>
          <div>
            <label for="portInput">Port</label>
            <input id="portInput" value="8080" type="number" min="1" max="65535" />
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Commands</h2>
        <div class="command-grid">
          <article class="command-card">
            <h3>Command Catalog</h3>
            <span class="badge get">GET</span>
            <small>/api/commands</small>
            <p>Enumerate every API endpoint exposed by this server.</p>
            <button data-command="commands" class="secondary">Send Request</button>
          </article>

          <article class="command-card">
            <h3>Health</h3>
            <span class="badge get">GET</span>
            <small>/api/health</small>
            <p>Confirm readiness and inspect uptime/version information.</p>
            <button data-command="health" class="secondary">Send Request</button>
          </article>

          <article class="command-card">
            <h3>Hello World</h3>
            <span class="badge get">GET</span>
            <small>/api/hello?name=...</small>
            <p>Returns a friendly greeting for the supplied name.</p>
            <label for="helloName">Name</label>
            <input id="helloName" placeholder="Web Client" value="Web Client" />
            <button data-command="hello" class="secondary">Send Request</button>
          </article>

          <article class="command-card">
            <h3>Echo</h3>
            <span class="badge post">POST</span>
            <small>/api/echo</small>
            <p>POST a JSON document and read the server's echo.</p>
            <label for="echoBody">Payload</label>
            <textarea id="echoBody">
{
  "client": "web-demo",
  "message": "Hello from the browser!"
}
            </textarea>
            <button data-command="echo" class="secondary">Send Request</button>
          </article>
        </div>
      </section>

      <section class="panel">
        <h2>Response</h2>
        <pre id="responseArea">Click a command to see the server response.</pre>
      </section>
    </main>

    <script>
      const responseArea = document.getElementById("responseArea");
      const helloInput = document.getElementById("helloName");
      const echoInput = document.getElementById("echoBody");

      document.querySelectorAll(".copy-button").forEach((button) => {
        button.addEventListener("click", async () => {
          const text = button.dataset.copy;
          try {
            await navigator.clipboard.writeText(text);
            button.textContent = "Copied!";
            setTimeout(() => (button.textContent = "Copy command"), 1400);
          } catch (_) {
            responseArea.textContent = `Clipboard unavailable. Command: ${text}`;
          }
        });
      });

      const commands = {
        commands: { method: "GET", path: "/api/commands" },
        health: { method: "GET", path: "/api/health" },
        hello: {
          method: "GET",
          buildPath: () => {
            const name = helloInput.value.trim() || "web-client";
            return `/api/hello?name=${encodeURIComponent(name)}`;
          },
        },
        echo: {
          method: "POST",
          path: "/api/echo",
          buildBody: () => {
            const raw = echoInput.value.trim();
            return raw || '{"client":"web-demo","message":"Hello from the browser!"}';
          },
        },
      };

      async function sendRequest(commandKey) {
        const host = document.getElementById("hostInput").value || "127.0.0.1";
        const port = document.getElementById("portInput").value || "8080";
        const baseUrl = `http://${host}:${port}`;

        const command = commands[commandKey];
        if (!command) {
          responseArea.textContent = `Unknown command: ${commandKey}`;
          return;
        }

        const path = typeof command.buildPath === "function" ? command.buildPath() : command.path;
        const body =
            typeof command.buildBody === "function" ? command.buildBody() : command.body ?? null;

        const requestInit = {
          method: command.method,
          headers: {},
        };

        if (body) {
          requestInit.body = body;
          requestInit.headers["Content-Type"] = "application/json";
        }

        responseArea.textContent = `Sending ${command.method} ${baseUrl}${path}...`;

        try {
          const response = await fetch(`${baseUrl}${path}`, requestInit);
          const text = await response.text();
          let formatted = text;
          try {
            const json = JSON.parse(text);
            formatted = JSON.stringify(json, null, 2);
          } catch (_) {
            // leave as-is
          }
          responseArea.textContent = `Status: ${response.status}\n${formatted}`;
        } catch (error) {
          responseArea.textContent = `Request failed: ${error.message}`;
        }
      }

      document.querySelectorAll("button[data-command]").forEach((button) => {
        button.addEventListener("click", () => sendRequest(button.dataset.command));
      });
    </script>
  </body>
</html>
